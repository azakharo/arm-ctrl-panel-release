"use strict";function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function log(a){console.log(a)}function logData(a){log(JSON.stringify(a,null,2))}function getBrowserInfo(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],{name:"IE ",version:a[1]||""}):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?{name:"Opera",version:a[1]}:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),{name:c[0],version:c[1]})}function getDays(a,b){return getTimeUnits(a,b,"days")}function getMonths(a,b){return getTimeUnits(a,b,"months")}function getYears(a,b){return getTimeUnits(a,b,"years")}function getTimeUnits(a,b,c){for(var d=[],e=a.clone();e.isBefore(b)||e.isSame(b);)d.push(e),e=e.clone(),e.add(1,c);return d}function isToday(a){return a.isSame(moment(),"day")}function isInt(a){return!isNaN(a)&&parseInt(Number(a))==a&&!isNaN(parseInt(a,10))}function isNumber(a){return!isNaN(parseFloat(a))}var isMyDebug=!1;angular.module("armCtrlPanelApp",["ngCookies","ngSanitize","ui.router","ui.bootstrap","ui.grid","ui.grid.autoResize","ui.grid.pagination","ui.grid.moveColumns","ui.grid.exporter","ui.grid.grouping","ui.grid.saveState","ngPromiseExtras","snap","angularSpinner","daterangepicker","angularjs-dropdown-multiselect","LocalStorageModule","authService","restService","loginDlg"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){var e="/ctrl-panel/statistic";b.otherwise(e),c.html5Mode(!1),d.interceptors.push("authInterceptor"),a.state("login",{url:"/login",template:'<login-dlg title="Контрольная панель оператора" success-route="ctrl-panel.statistic" success-route-debug="ctrl-panel.statistic" />',controller:function(){}})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("acceptant")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location","$log",function(a,b,c,d,e){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers["Auth-Access-Token"]=c.get("token")),a},responseError:function(a){return 401===a.status||403===a.status?(e.debug("intercepted "+a.status),d.path("/login"),c.remove("token"),c.remove("username"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$state","Auth","$log",function(a,b,c,d){a.$on("$stateChangeStart",function(e,f){f.authenticate&&!c.isLoggedIn()&&(d.debug("need auth, redirect to login"),a.state2routeAfterLogin=f.name,e.preventDefault(),b.go("login"))})}]).run(["$rootScope",function(a){a.dateStart=moment().subtract(7,"days").startOf("day"),a.dateFinish=moment().endOf("day")}]).run(["i18nService","uibDatepickerPopupConfig","myRest",function(a,b,c){c.getApps(),moment.locale("ru"),a.setCurrentLang("ru"),b.currentText="Сегодня",b.clearText="Очистить",b.closeText="Закрыть",b.appendToBody=!0}]);var ddMultiSelectTranslationRU={checkAll:"Выбрать все",uncheckAll:"Убрать все",selectionCount:"выбрано",selectionOf:"из",searchPlaceholder:"Найти...",buttonDefaultText:"Выбрать",dynamicButtonTextSuffix:"выбрано"};angular.module("armCtrlPanelApp").controller("CtrlPanelCtrl",["$scope","$rootScope","$state","$log","Auth","myRest",function(a,b,c,d,e,f){function g(a){d.debug(a)}a.Auth=e,b.isGettingData=!1,a.onSettingsBtnClick=function(){g("settings clicked")},a.onLogOutBtnClick=function(){c.go("login"),e.logout()},a.naviMenuItems=[{url:f.getDashboardUrl(),name:"Дашборд"}],a.menuItems=[{title:"Оборудование",state:"ctrl-panel.hardware",icon:"fa-bus"},{title:"Транзакции",state:"ctrl-panel.transactions",icon:"fa-table"},{title:"Статистика",state:"ctrl-panel.statistic",icon:"fa-line-chart"}],a.onMenuItemClick=function(a){c.go(a)},a.isCurrentState=function(a){return a===c.$current.name},a.resizeDataView=function(){}}]),angular.module("armCtrlPanelApp").config(["$stateProvider",function(a){a.state("ctrl-panel",{"abstract":!0,url:"/ctrl-panel",templateUrl:"/ctrl-panel/app/ctrl-panel/ctrlPanel.html",controller:"CtrlPanelCtrl"}).state("ctrl-panel.hardware",{url:"/hardware",templateUrl:"/ctrl-panel/app/ctrl-panel/hardware.html",controller:"HardwareCtrl"}).state("ctrl-panel.transactions",{url:"/transactions",templateUrl:"/ctrl-panel/app/ctrl-panel/transactions.html",controller:"TransactionsCtrl"}).state("ctrl-panel.statistic",{url:"/statistic",templateUrl:"/ctrl-panel/app/ctrl-panel/statistic.html",controller:"StatisticCtrl"})}]),angular.module("armCtrlPanelApp").controller("HardwareCtrl",["$scope",function(a){}]),angular.module("armCtrlPanelApp").controller("StatisticCtrl",["$scope","$rootScope","$log","$filter","$q","uiGridConstants","uiGridGroupingConstants","localStorageService","myRest",function(a,b,c,d,e,f,g,h,i){function j(){var b=a.gridApi.saveState.save();h.set(n,b)}function k(){var b=h.get(n);b&&a.gridApi.saveState.restore(a,b)}function l(){a.gridApi.grouping.clearGrouping(),a.gridApi.grouping.groupColumn(a.groupBy),a.gridApi.grouping.aggregateColumn("passengers",g.aggregation.SUM),a.gridApi.grouping.aggregateColumn("passKm",g.aggregation.SUM),"day"===a.groupBy&&a.gridApi.grouping.aggregateColumn("bus",g.aggregation.COUNT)}function m(){a.noData=!1,b.isGettingData=!1,a.isFilterChanged=!1}b.isGettingData=!1,a.$on("$destroy",function(){j()});var n="statGridState";a.datePicker={},a.datePicker.date={startDate:moment().startOf("day").subtract(1,"weeks"),endDate:moment()},a.today=moment(),a.dateRangePickerOpts={eventHandlers:{"apply.daterangepicker":function(){},"cancel.daterangepicker":function(){}},locale:{applyLabel:"ОК",cancelLabel:"Отмена",customRangeLabel:"Выбрать"},ranges:{"С начала недели":[moment().startOf("week"),moment()],"С начала месяца":[moment().startOf("month"),moment()],"За последние 30 дней":[moment().subtract(29,"days").startOf("day"),moment()]}},a.isFilterChanged=!0,a.$watch("datePicker.date",function(){return a.isFilterChanged=!0});var o="statGroupType",p=h.get(o);a.groupBy=p?p:"day",a.$watch("groupBy",function(){l(),h.set(o,a.groupBy)}),a.exportFormat="csv",a.gridOptions={exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"landscape",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterHeaderFilter:function(a){return a},exporterFieldCallback:function(a,b,c,e){return"day"===c.name?d("date")(e,"dd.MM.yyyy"):e},onRegisterApi:function(b){a.gridApi=b,b.colMovable.on.columnPositionChanged(a,function(a,b,c){j()}),b.core.on.columnVisibilityChanged(a,function(a){j()})},saveGrouping:!1,saveGroupingExpandedStates:!1},a.onExportBtnClick=function(){"csv"==a.exportFormat?a.gridApi.exporter.csvExport("all","all"):"pdf"==a.exportFormat&&a.gridApi.exporter.pdfExport("all","all")},a.gridOptions.columnDefs=[{displayName:"Дата",name:"day",field:"day.toDate()",type:"date",cellFilter:'date: "dd.MM.yyyy"',sort:{direction:"desc"}},{displayName:"Борт",field:"bus",customTreeAggregationFinalizerFn:function(a){"count"===a.type?a.label?a.rendered="всего бортов: "+a.value:a.groupVal?a.rendered=a.groupVal:a.rendered=a.value:a.rendered=a.value}},{displayName:"Пассажиропоток",field:"passengers",cellClass:"text-right",headerCellClass:"text-right",headerTooltip:"кол-во перевезённых пассажиров"},{displayName:"Пассажирооборот",name:"passKm",field:"passKm",cellClass:"text-right",headerCellClass:"text-right",headerTooltip:"пассажиро-километры"}],a.gridOptions.enableHorizontalScrollbar=f.scrollbars.NEVER,a.gridOptions.enableVerticalScrollbar=f.scrollbars.WHEN_NEEDED,a.gridOptions.enableColumnMenus=!1,a.gridOptions.data=[],a.gridOptions.enableGridMenu=!0,a.gridOptions.exporterMenuPdf=!1,a.noData=!1;var q=!0;a.onLoadBtnClick=function(){a.gridOptions.data=[],b.isGettingData=!0,e.allSettled([i.getStatPassengersPerDayPerBus(a.datePicker.date.startDate,a.datePicker.date.endDate),i.getStatPassKmPerDayPerBus(a.datePicker.date.startDate,a.datePicker.date.endDate)]).then(function(b){m(),b=_.map(b,function(a){return"fulfilled"===a.state?a.value:[]});var c=b[0],d=b[1];_.forEach(c,function(a){var b=_.find(d,function(b){return b.day.isSame(a.day)&&b.bus===a.bus});b&&(a.passKm=b.passKm)}),a.gridOptions.data=_.reverse(c),a.noData=0===a.gridOptions.data.length,q&&(k(),q=!1),l()},function(a){m()})}}]);var DISP_STR_ESEK="ЕСЭК",DISP_STR_TICKET="электрон.билет";angular.module("armCtrlPanelApp").controller("TransactionsCtrl",["$scope","$rootScope","$log","$filter","$q","uiGridConstants","localStorageService","myRest",function(a,b,c,d,e,f,g,h){function i(){var b=a.gridApi.saveState.save();g.set(k,b)}function j(){var b=g.get(k);b&&a.gridApi.saveState.restore(a,b)}b.isGettingData=!0,a.$on("$destroy",function(){i()});var k="transGridState";a.datePicker={},a.datePicker.date={startDate:moment().startOf("day").subtract(2,"months"),endDate:moment()},a.today=moment(),a.dateRangePickerOpts={eventHandlers:{"apply.daterangepicker":function(){},"cancel.daterangepicker":function(){}},locale:{applyLabel:"ОК",cancelLabel:"Отмена",customRangeLabel:"Выбрать"},ranges:{"С начала недели":[moment().startOf("week"),moment()],"С начала месяца":[moment().startOf("month"),moment()],"За последние 30 дней":[moment().subtract(29,"days").startOf("day"),moment()]}};var l={externalIdProp:"",smartButtonMaxItems:3,scrollable:!0};a.ruTranslation=ddMultiSelectTranslationRU,a.busOptions=[],a.selectedBuses=[],a.paymentMethOptions=[],a.selectedPaymentMethods=[],e.all([h.getTerminals(),h.getTariffs()]).then(function(c){var d=c[0],e=c[1],f=_.map(d,function(a){return{name:a.number}});a.busOptions=f,a.selectedBuses=angular.copy(f);var g=_.map(e,function(a){return{name:a.name,currency:a.currency}});a.selectedPaymentMethods=angular.copy(g),a.paymentMethOptions=g,b.isGettingData=!1},function(a){b.isGettingData=!1});var m=angular.copy(l);m.displayProp="name",m.idProp="name",m.scrollable=!1,a.busDdSettings=m;var n=angular.copy(l);n.displayProp="name",n.idProp="name",n.scrollable=!0,n.smartButtonMaxItems=1,a.paymentMethSettings=n;var o={name:DISP_STR_ESEK},p={name:DISP_STR_TICKET},q=[o,p];a.selectedCardTypes=angular.copy(q),a.cardTypeOptions=q;var r=angular.copy(l);r.displayProp="name",r.idProp="name",a.cardTypeSettings=r,a.isFilterChanged=!0,a.$watchCollection("selectedBuses",function(){return a.isFilterChanged=!0}),a.$watchCollection("selectedPaymentMethods",function(){return a.isFilterChanged=!0}),a.$watchCollection("selectedCardTypes",function(){return a.isFilterChanged=!0}),a.$watchCollection("selectedCards",function(){return a.isFilterChanged=!0}),a.$watch("datePicker.date",function(){return a.isFilterChanged=!0}),a.exportFormat="csv",a.gridOptions={exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"landscape",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterHeaderFilter:function(a){return a},exporterFieldCallback:function(a,b,c,e){return"time"===c.name?d("date")(e,"dd.MM.yyyy HH:mm"):"cardType"===c.name?e.isEsek?DISP_STR_ESEK:DISP_STR_TICKET:e},onRegisterApi:function(b){a.gridApi=b,b.colMovable.on.columnPositionChanged(a,function(a,b,c){i()}),b.core.on.columnVisibilityChanged(a,function(a){i()})}},a.onExportBtnClick=function(){"csv"==a.exportFormat?a.gridApi.exporter.csvExport("all","all"):"pdf"==a.exportFormat&&a.gridApi.exporter.pdfExport("all","all")},a.gridOptions.columnDefs=[{displayName:"Время",name:"time",field:"timestamp",cellFilter:"transTimeFilter",enableFiltering:!1},{displayName:"Борт",field:"bus",enableFiltering:!1},{displayName:"Способ оплаты",field:"tariff.name",enableFiltering:!1},{displayName:"Тип карты",name:"cardType",field:"card.isEsek",cellFilter:"cardTypeFilter",enableFiltering:!1},{displayName:"№ карты",field:"card.num",cellClass:"text-right",headerCellClass:"text-right"}],a.gridOptions.enableHorizontalScrollbar=f.scrollbars.NEVER,a.gridOptions.enableVerticalScrollbar=f.scrollbars.WHEN_NEEDED,a.gridOptions.enableColumnMenus=!1,a.gridOptions.paginationPageSizes=[50,100,200,250,500],a.gridOptions.data=[],a.gridOptions.enableFiltering=!0,a.gridOptions.enableGridMenu=!0,a.gridOptions.exporterMenuPdf=!1,a.noData=!1;var s=!0;a.onLoadBtnClick=function(){a.gridOptions.data=[],b.isGettingData=!0;var c=null,d=a.selectedPaymentMethods;d&&d.length>0&&d.length!=a.paymentMethOptions.length&&(c=_.map(d,function(a){return a.currency.srvID}));var f=null,g=a.selectedBuses;g&&g.length>0&&g.length!=a.busOptions.length&&(f=_.map(g,function(a){return a.name})),e.all([h.getAccounts(),h.getPaymentsBy(a.datePicker.date.startDate,a.datePicker.date.endDate,c,f)]).then(function(c){var d=_.map(c[0],function(a){return{num:a.number,accountId:a.id,isEsek:h.isEsek(a)}}),e=c[1],f=a.selectedCards;f&&f.length>0&&f.length!=a.cardOptions.length&&!function(){var a=_.map(f,"accountId");e=_.filter(e,function(b){return _.includes(a,b.accountId)})}();var g=a.selectedCardTypes;g&&g.length>0&&g.length!=a.cardTypeOptions.length&&(_.find(g,["name",o.name])&&(e=_.filter(e,function(a){var b=_.find(d,["accountId",a.accountId]);return b?b.isEsek:!1})),_.find(g,["name",p.name])&&(e=_.filter(e,function(a){var b=_.find(d,["accountId",a.accountId]);return b?!b.isEsek:!1}))),a.gridOptions.data=_.map(e,function(b){var c=_.find(d,["accountId",b.accountId]),e=_.find(a.paymentMethOptions,function(a){return b.currencyId===a.currency.srvID});return{timestamp:b.timestamp,card:c,tariff:e,bus:b.source.terminal}}),a.noData=0===a.gridOptions.data.length,b.isGettingData=!1,a.isFilterChanged=!1,s&&(j(),s=!1)},function(a){b.isGettingData=!1})}}]).filter("DatePickerFilter",function(){return function(a){var b="DD.MM.YYYY",c=a.startDate,d=a.endDate;return c.isSame(d,"day")?isToday(c)?"сегодня":c.format(b):"период "+c.format(b)+" - "+d.format(b)}}).filter("transTimeFilter",function(){return function(a){return moment.unix(a).format("DD.MM.YYYY HH:mm")}}).filter("cardTypeFilter",function(){return function(a){return a?DISP_STR_ESEK:DISP_STR_TICKET}}),angular.module("armCtrlPanelApp").controller("TestCtrl",["$scope","uibDatepickerPopupConfig",function(a,b){a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.maxDate=new Date(2020,5,22),a.open=function(b){a.status.opened=!0},a.setDate=function(b,c,d){a.dt=new Date(b,c,d)},a.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1},b.currentText="Сегодня",b.clearText="Очистить",b.closeText="Закрыть",a.formats=["dd.MM.yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0],a.status={opened:!1};var c=new Date;c.setDate(c.getDate()+1);var d=new Date;d.setDate(c.getDate()+2),a.events=[{date:c,status:"full"},{date:d,status:"partially"}],a.getDayClass=function(b,c){if("day"===c)for(var d=new Date(b).setHours(0,0,0,0),e=0;e<a.events.length;e++){var f=new Date(a.events[e].date).setHours(0,0,0,0);if(d===f)return a.events[e].status}return""}}]),angular.module("armCtrlPanelApp").config(["$stateProvider",function(a){a.state("test",{url:"/test",templateUrl:"/ctrl-panel/app/test/test.html",controller:"TestCtrl"})}]);var mod=angular.module("alertService",[]);mod.factory("alertService",["$rootScope","$timeout","$interval","$window",function(a,b,c,d){var e={};return a.alerts=[],e.add=function(c,d){var f={type:c,msg:d,close:function(){e.closeAlert(this)}};a.alerts.push(f),b(function(){e.closeAlert(f)},8e3)},e.closeAlert=function(b){e.closeAlertByIndex(a.alerts.indexOf(b))},e.closeAlertByIndex=function(b){a.alerts.splice(b,1)},e.clear=function(){a.alerts=[]},e}]),angular.module("authService",["restService"]).factory("Auth",["$cookieStore","$q","myRest","$log",function(a,b,c,d){function e(){f("logout"),a.remove(g),a.remove(h)}function f(a){d.debug(a)}var g="token",h="username";return{login:function(d,f){var i=b.defer();return c.login(d,f).then(function(b){a.put(g,b),a.put(h,d),i.resolve(d)},function(a){e(),i.reject(a)}),i.promise},logout:e,getCurrentUser:function(){return a.get(h)},isLoggedIn:function(){return void 0!==a.get(g)}}}]),angular.module("loginDlg",["authService"]).controller("LoginDlgCtrl",["$scope","$rootScope","Auth","$state",function(a,b,c,d){a.errors={},$("#username-input").focus(),a.login=function(e){a.submitted=!0,e.$valid&&c.login(a.username,a.password).then(function(){var c;b.state2routeAfterLogin?(c=b.state2routeAfterLogin,b.state2routeAfterLogin=void 0):c=isMyDebug?a.successRouteDebug:a.successRoute,d.go(c)})["catch"](function(){a.errors.other="Не удалось войти, повторите ввод данных."})}}]),angular.module("loginDlg").directive("loginDlg",function(){return{scope:{title:"@",successRoute:"@",successRouteDebug:"@"},controller:"LoginDlgCtrl",templateUrl:"/ctrl-panel/components/shared/login/login.html"}}),angular.module("modalService",[]).factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"/ctrl-panel/components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]);var isRestDebug=!1,mod=angular.module("restService",[]);mod.service("myRest",["$http","$q","$log","$rootScope",function(a,b,c,d){function e(){return Ea}function f(){return Ka}function g(){return La}function h(){return Ma}function i(){var b=a({method:"get",url:Ea+"accounts"});return b.then(V,U)}function j(b){var c=a({method:"get",url:Ha+"accounts/"+b});return c.then(V,U)}function k(b){var c=a({method:"get",url:Ea+format("accounts/{}/bags",b)});return c.then(V,U)}function l(b){var c=a({method:"get",url:Ea+format("accounts/{}/transactions",b)});return c.then(V,U)}function m(b){var c=a({method:"get",url:Ea+format("accounts/{}/medias",b)});return c.then(V,U)}function n(){var b=a({method:"get",url:Ea+"applications"});return b.then(V,U)}function o(b){var c=a({method:"get",url:Ea+format("applications/{}/currencies",b)});return c.then(V,U)}function p(){var a=[],c=b.defer();return i().then(function(b){var d=0;b.forEach(function(e){l(e.id).then(function(e){a=a.concat(e),d===b.length-1&&(a=_.sortBy(a,function(a){return-a.timestamp}),c.resolve(a)),d+=1})})},function(a){c.reject(a)}),c.promise}function q(){var b=a({method:"get",url:Fa+"vehicles"});return b.then(V,U)}function r(){var b=a({method:"get",url:Fa+"terminals"});return b.then(V,U)}function s(b){var c=a({method:"get",url:Fa+format("vehicles/{}/turnovers",b)});return c.then(V,U)}function t(b){var c=a({method:"get",url:Fa+format("vehicles/{}/traffics",b),params:{limit:100,sort:"-timestamp"}});return c.then(V,U)}function u(b){var c=a({method:"get",url:Ea+("applications/"+b+"/prices")});return c.then(V,U)}function v(b){var c=a({method:"get",url:Ea+("applications/"+b+"/services")});return c.then(V,U)}function w(){var a=[],c=b.defer();return n().then(function(b){0===b.length&&c.resolve(a);var d=b[0].id;o(d).then(function(b){b.forEach(function(b){var c={};c.srvID=b.id,c.code=b.symbol,c.name=b.title,c.isPrivileged=null!==b.exemption,c.privilege=null!==b.exemption?b.exemption:"нет льгот",c.isAbonnement=!b.countable,a.push(c)}),c.resolve(a)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function x(a){var c=[],d=b.defer();return i().then(function(b){var e=0;b.forEach(function(f){var g={};g.id=f.number,g.srvAccountID=f.id,g.state="success",g.isESEK=Da(f),g.personID=f.userId,g.bags=[],g.isBlocked=!1,m(f.id).then(function(h){if(h&&h.length>0){var i=h[0];g.RFID=i.rfid,g.mediaSrvID=i.id;var j=_(i.states).find(function(a){return"activated"===a.state});j?g.activatedAt=moment.unix(j.timestamp):g.activatedAt=null,i.states&&i.states.length>0&&(g.isBlocked="blocked"===i.states[0].state)}k(f.id).then(function(f){f.forEach(function(b){var c={};c.srvID=b.id,c.activePeriodStart=moment.unix(b.timeframe.startTimestamp),c.activePeriodFinish=moment.unix(b.timeframe.finishTimestamp),c.currency=_.find(a,function(a){return a.srvID===b.currencyId}),g.bags.push(c)}),c.push(g),e===b.length-1&&d.resolve(c),e+=1})})})},function(a){d.reject(a)}),d.promise}function y(){var a=b.defer();return w().then(function(c){x(c).then(function(c){var d=_.map(c,function(a){return j(a.srvAccountID)});b.allSettled(d).then(function(b){var d=_.map(b,function(a){return"fulfilled"===a.state?a.value:null});c.forEach(function(a,b){var c=d[b];if(c&&c.bagInfos&&c.bagInfos.length>0){a.bags.forEach(function(a){var b=_(c.bagInfos).find(function(b){return a.srvID===b.lastTransaction.bagId});if(b){a.balance=b.balance,a.transCount=b.operationCounter;var d={};d.id=b.lastTransaction.id,d.srvTransactionID=b.lastTransaction.id,d.timestamp=moment.unix(b.lastTransaction.timestamp),d.operation=b.lastTransaction.type,d.currency=a.currency,d.value=b.lastTransaction.value,d.isSuccess="valid"===b.lastTransaction.status,d.isPayment="payment"===b.lastTransaction.type,d.isReplenishment="replenishment"===b.lastTransaction.type,a.latestTrans=d}});var e=_.max(a.bags,function(a){return a.latestTrans.timestamp.unix()});e&&(e.isLatestTrans=!0,a.latestTrans=e.latestTrans)}}),c=_.sortBy(c,function(a){return-a.id}),c=_.sortBy(c,function(a){return a.latestTrans?-a.latestTrans.timestamp:-moment.unix(0)}),a.resolve(c)},function(){})},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}function z(a){var c=b.defer();return w().then(function(b){x(b).then(function(b){var d=B(b,a);c.resolve(d)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function A(a,b){var c=void 0;return _(a).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c}function B(a,b){var c=void 0;return _(a).forEach(function(a){return a.id===b?(c=a,!1):void 0}),c}function C(a,b){var c=void 0;return _(a).forEach(function(a){return _(a.bags).forEach(function(d){return d.srvID===b?(c=a,!1):void 0}),c?!1:void 0}),c}function D(a,b){var c=void 0;return _(a).forEach(function(a){return _(a.bags).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c?!1:void 0}),c}function E(a,b){var c=void 0;return _(a.bags).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c}function F(){var a=b.defer();return w().then(function(b){x(b).then(function(b){p().then(function(c){var d=[],e=0;c.forEach(function(a){var c={};c.id=e+1,c.srvTransactionID=a.id,c.timestamp=moment.unix(a.timestamp),c.operation=a.type;var f=D(b,a.bagId);f&&(c.currency=f.currency),c.value=a.value,c.isSuccess="valid"===a.status,c.isPayment="payment"===a.type,c.isReplenishment="replenishment"===a.type,d.push(c),e+=1}),a.resolve(d)},function(b){a.reject(b)})},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}function G(){var a=void 0,c=b.defer();return q().then(function(b){if(0===b.length)return void c.resolve(a);var d=b[0];s(d.id).then(function(b){if(0===b.length)return void c.resolve(a);var d=b[b.length-1];c.resolve(d.quantity)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function H(){var a=[],c=b.defer();return q().then(function(b){0===b.length&&c.resolve(a);var d=b[0];s(d.id).then(function(b){0===b.length&&c.resolve(a),_(b).forEach(function(b){var c={};c.timestamp=moment.unix(b.timestamp),c.value=b.quantity,a.push(c)}),c.resolve(a)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function I(a,c){var d=[],e=b.defer(),f=0;return q().then(function(b){0===b.length&&e.resolve(d),_(b).forEach(function(g){s(g.id).then(function(h){var h=_.filter(h,function(b){return moment.unix(b.timeframe.finishTimestamp).isBetween(a,c)});_(h).forEach(function(a){var b={};b.timestamp=moment.unix(a.timeframe.finishTimestamp),b.quantity=a.quantity,b.distance=a.distance,b.vehicle=g.title,d.push(b)}),f===b.length-1&&(d=_.sortBy(d,function(a){return a.timestamp}),e.resolve(d)),f+=1},function(a){e.reject(a)})})},function(a){e.reject(a)}),e.promise}function J(){var b=a({method:"get",url:Ga+"exemptions"});return b.then(V,U)}function K(){var b=a({method:"get",url:Ga+"persons"});return b.then(V,U)}function L(){var a=[],c=b.defer();return J().then(function(b){b.forEach(function(b){var c={};c.srvID=b.id,c.code=b.ouid,c.name=b.title,a.push(c)}),c.resolve(a)},function(a){c.reject(a)}),c.promise}function M(a){var c=null,d=b.defer();return null===a?(d.reject("person id is null"),d.promise):(L().then(function(b){K().then(function(e){var f=_(e).find(function(b){return b.uuid===a});if(!f)return d.resolve(c),d.promise;c={},c.srvID=f.id,c.id=a,c.name=f.name;var g=[];f.exemptions[0].forEach(function(a){var c=_(b).find(function(b){return b.srvID===a.exemptionid});if(c){var d=angular.copy(c);a.timeframe&&(a.timeframe.startTimestamp&&(d.activePeriodStart=moment.unix(a.timeframe.startTimestamp)),a.timeframe.finishTimestamp&&(d.activePeriodFinish=moment.unix(a.timeframe.finishTimestamp))),g.push(d)}}),c.privileges=g,d.resolve(c)},function(a){d.reject(a)})},function(a){d.reject(a)}),d.promise)}function N(){var a=[],c=b.defer();return q().then(function(b){var d=0;b.forEach(function(e){t(e.id).then(function(f){var g=[];f.forEach(function(a){var b={};b.timestamp=moment.unix(a.timestamp),b.busID=e.terminal_id,a.delta>=0?b.input=a.delta:b.output=-a.delta,g.push(b)}),a=a.concat(g),d===b.length-1&&(a=_.sortBy(a,function(a){return-a.timestamp}),c.resolve(a)),d+=1})})},function(a){c.reject(a)}),c.promise}function O(a,c){var d=b.defer();return N().then(function(b){var b=_.filter(b,function(b){return b.timestamp.isBetween(a,c)}),b=_.filter(b,function(a){return a.input});b.reverse(),d.resolve(b)},function(a){d.reject(a)}),d.promise}function P(b,c,d){var e={rfid:b.rfid,number:b.num,timeframe:{startTimestamp:c.unix(),finishTimestamp:d.unix()},user_id:"567834901"},f=a({method:"post",url:Ha+"activatecard",data:e});return f.then(V,U)}function Q(b,c,d){var e={rfid:b.rfid,number:b.num,timeframe:{startTimestamp:c.unix(),finishTimestamp:d.unix()},replenishment_data:{}};b.isFixedTripNumTicket?(e.replenishment_data.symbol="PFTT",e.replenishment_data.value=b.tripsLeft):b.isMonthTicketFullPrice?(e.replenishment_data.symbol="PR",e.replenishment_data.value=1):b.isMonthTicketPensioner&&(e.replenishment_data.symbol="PRP",e.replenishment_data.value=1);var f=a({method:"post",url:Ha+"activatecard",data:e});return f.then(V,U)}function R(){var c=b.defer();return a.get("/api/cards").then(function(a){var b=a.data.card;b&&(b.activePeriodStart=moment.unix(b.activePeriodStart),b.activePeriodFinish=moment.unix(b.activePeriodFinish)),c.resolve(b)},function(a){c.reject(a)}),c.promise}function S(){var c=b.defer();return a.get("/api/tickets").then(function(a){var b=a.data.ticket;b&&(b.activePeriodStart=moment.unix(b.activePeriodStart),b.activePeriodFinish=moment.unix(b.activePeriodFinish)),c.resolve(b)},function(a){c.reject(a)}),c.promise}function T(b,c){a.post("/api/tickets/activate",{start:b.unix(),end:c.unix()})}function U(a){return d.urlCausedError=a.config.url,502==a.status||503==a.status||0==a.status?(d.isRestUnavailable=!0,W(format("Адрес {} недоступен",d.urlCausedError))):500==a.status?(d.isRestError=!0,W(format("При обращении по адресу {} произошла ошибка",d.urlCausedError))):d.isRestUnavailable||d.isRestError?(d.isRestUnavailable=!1,d.isRestError=!1):(d.isRestUnavailable=!1,d.isRestError=!1),angular.isObject(a.data)&&a.data.message?b.reject({msg:a.data.message,code:a.status}):b.reject({msg:"An unknown error occurred.",code:a.status})}function V(a){return d.isRestUnavailable=!1,d.isRestError=!1,d.urlCausedError=null,a.data}function W(a){c.debug(a)}function X(b,c){var d=a({method:"post",url:Ea+"vehicles/1/turnovers",data:[{timeframe:{startTimestamp:b.unix()-1e3,finishTimestamp:b.unix()},distance:1e3,quantity:c}]});return d.then(V,U)}function Y(b,c){var d=a({method:"post",url:Ea+"replenishments",data:{symbol:"TRB",rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:null,finishTimestamp:null},value:c}});return d.then(V,U)}function Z(b,c,d,e){var f="";if(1===c)f="PRP";else{if(2!==c)throw"Unknown month ticket type: "+c;f="PR"}var g=moment().year(e).month(d-1).date(1).hour(0).minute(0).second(0).millisecond(0),h=moment().year(e).month(d-1).add(1,"months").date(1).hour(0).minute(0).second(0).millisecond(0),i=a({method:"post",url:Ea+"replenishments",data:{symbol:f,rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:g.unix(),finishTimestamp:h.unix()},value:1}});return i.then(V,U)}function $(b,c){var d=a({method:"post",url:Ea+"replenishments",data:{symbol:"PFTT",rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:moment().startOf("day").unix(),finishTimestamp:moment().startOf("day").add(1,"years").unix()},value:c}});return d.then(V,U)}function aa(b){var c=a({method:"post",url:Ea+"payment",data:{rfid:"1111-2222-3333-4444",timestamp:b.unix(),serviceId:3,applicationId:3,providerId:4}});return c.then(V,U)}function ba(b){var c=a({method:"post",url:Ea+format("accounts/{}/medias/{}/states",b.srvAccountID,b.mediaSrvID),data:'"blocked"'});return c.then(V,U)}function ca(b){var c=a({method:"post",url:Ea+format("accounts/{}/medias/{}/states",b.srvAccountID,b.mediaSrvID),data:'"activated"'});return c.then(V,U)}function da(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Ea+"stat/transactions/exemptions",params:g}).then(function(a){var b=getDays(c,d);b.forEach(function(b,c){var d=0,e=0,g=a.data[c].exemptions;if(g&&g.length>0){var h=_.find(g,function(a){return null===a.exemption});h&&(d=h.number);var i=_.filter(g,function(a){return null!==a.exemption});e=_.reduce(i,function(a,b){return a+b.number},0)}var j={day:b,fullyPaid:d,privileged:e};f.push(j)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function ea(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Ea+"stat/transactions/exemptions",params:g}).then(function(a){var b=a.data[0].exemptions;b&&b.length>0&&b.forEach(function(a){var b={};b.privilege=null!==a.exemption?a.exemption:"нет льгот",b.transactionCount=a.number,f.push(b)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function fa(a,c){var d=b.defer(),e={fullyPaid:0,privileged:0};return da(a,c).then(function(a){e.privileged=_.reduce(a,function(a,b){return a+b.privileged},0),e.fullyPaid=_.reduce(a,function(a,b){return a+b.fullyPaid},0),d.resolve(e)},function(a){d.reject(a)}),d.promise}function ga(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Ea+"stat/transactions/users",params:g}).then(function(a){var b=getDays(c,d);b.forEach(function(b,c){var d={day:b,totalPaidByEsek:a.data[c].personal,totalPaidByTicket:a.data[c].impersonal};f.push(d)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function ha(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Ea+"stat/transactions/users",params:f}).then(function(a){e.resolve({totalPaidByEsek:a.data[0].personal,totalPaidByTicket:a.data[0].impersonal})},function(a){e.reject(a)}),e.promise}function ia(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Fa+"stat/traffics",params:f}).then(function(a){e.resolve(a.data._summary_owner._summary_vehicle[0].amount_inlet)},function(a){e.reject(a)}),e.promise}function ja(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Fa+"stat/traffics",params:g}).then(function(a){var b=getDays(c,d);b.forEach(function(b,c){var d={day:b,passengers:a.data._summary_owner._summary_vehicle[c].amount_inlet,passCountErr:a.data._summary_owner._summary_vehicle[c].error};f.push(d)}),
e.resolve(f)},function(a){e.reject(a)}),e.promise}function ka(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Fa+"stat/traffics",params:g}).then(function(a){var b=a.data,g=_.find(Object.getOwnPropertyNames(b),function(a){return"_summary_owner"!==a}),h=b[g],i=_.filter(Object.getOwnPropertyNames(h),function(a){return"_summary_vehicle"!==a}),j=getDays(c,d);j.forEach(function(a,b){i.forEach(function(c){var d={day:a,bus:c,passengers:h[c][b].amount_inlet};f.push(d)})}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function la(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Fa+"stat/turnovers",params:g}).then(function(a){var b=a.data,g=_.find(Object.getOwnPropertyNames(b),function(a){return"_summary_owner"!==a}),h=b[g],i=_.filter(Object.getOwnPropertyNames(h),function(a){return"_summary_vehicle"!==a}),j=getDays(c,d);j.forEach(function(a,b){i.forEach(function(c){var d={day:a,bus:c,passKm:Math.round(h[c][b].amount_turnover/1e3)};f.push(d)})}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function ma(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Fa+"stat/active/vehicles",params:g}).then(function(a){var b=getDays(c,d);b.forEach(function(b,c){var d={day:b,buses:a.data[c].amount};f.push(d)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function na(c,d){var e=b.defer(),f=[],g={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Ea+"stat/transactions/status",params:g}).then(function(a){var b=getDays(c,d);b.forEach(function(b,c){var d={day:b,successes:a.data[c].valid_number,errors:a.data[c].invalid_number};f.push(d)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function oa(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Ea+"stat/transactions/status",params:f}).then(function(a){e.resolve({start:c,end:d,successes:a.data[0].valid_number,errors:a.data[0].invalid_number})},function(a){e.reject(a)}),e.promise}function pa(c,d,e){var f=b.defer(),g=[],h={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:3600};return a({method:"get",url:Fa+"stat/traffics",params:h}).then(function(a){a=a.data._summary_owner._summary_vehicle;var b=a.length,c=_.times(24,function(a){return a});c.forEach(function(c){for(var d=c,e=0;b>d;)e+=a[d].amount_inlet,d+=24;g.push(e)}),g=_.map(g,function(a){return Math.round(a/e)}),f.resolve(g)},function(a){f.reject(a)}),f.promise}function qa(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Fa+"stat/turnovers",params:f}).then(function(a){e.resolve(a.data._summary_owner._summary_vehicle[0].amount_turnover/1e3)},function(a){e.reject(a)}),e.promise}function ra(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix(),windowTime:86400};return a({method:"get",url:Fa+"stat/turnovers",params:f}).then(function(a){var b=a.data,f=[],g=Object.getOwnPropertyNames(b);g=_.filter(g,function(a){return"_summary_owner"!==a});var h=getDays(c,d);g.forEach(function(a){var c={name:a},d=[];h.forEach(function(c,e){var f={day:c,passKm:b[a]._summary_vehicle[e].amount_turnover/1e3};d.push(f)}),c.passKms=d,f.push(c)}),e.resolve(f)},function(a){e.reject(a)}),e.promise}function sa(a,c){var d=b.defer();return ra(a,c).then(function(a){var b=_.map(a,"passKms");b&&0!==b.length||d.resolve([]);var c=_.map(b[0],"day"),e=[];c.forEach(function(a,c){var d={day:a},f=_.map(b,function(a){return a[c].passKm});d.passKm=_.reduce(f,function(a,b){return a+b}),e.push(d)}),d.resolve(e)},function(a){d.reject(a)}),d.promise}function ta(c,d){var e=b.defer(),f={startTimestamp:c.unix(),finishTimestamp:d.unix()};return a({method:"get",url:Ea+"stat/transactions/users",params:f}).then(function(a){e.resolve(a.data[0].impersonal+a.data[0].personal)},function(a){e.reject(a)}),e.promise}function ua(){var a=[],c=b.defer();return va().then(function(d){return d?void b.all([w(),u(d.id),v(d.id)]).then(function(b){var d=b[0],e=b[1],f=b[2];e.forEach(function(b){var c=_.find(d,function(a){return a.srvID===b.currencyId}),e=_.find(f,function(a){return a.id===b.serviceId});if(c){var g={currency:c,price:b.value,name:c.name,desc:e?e.title:"",type:c.isAbonnement?"Проездной":"Разовый",activePeriodStart:isInt(b.timeframe.startTimestamp)?b.timeframe.startTimestamp:null,activePeriodFinish:isInt(b.timeframe.finishTimestamp)?b.timeframe.finishTimestamp:null};a.push(g)}}),c.resolve(a)},function(a){c.reject(a)}):(c.resolve([]),c.promise)},function(a){c.resolve([])}),c.promise}function va(){var a=b.defer();return n().then(function(b){b&&0!==b.length||a.resolve(null);var c=_.find(b,function(a){return a.title.match(/Транспортное/i)});a.resolve(c?c:app[0])},function(b){a.resolve(null)}),a.promise}function wa(d,e){var f=b.defer();return a({method:"post",url:Ia,headers:{Authorization:"Basic "+btoa(d+":"+e)}}).success(function(a){c.debug("Login SUCCESS"),f.resolve(a.key)}).error(function(a){c.debug("Login FAILURE"),f.reject(a)}),f.promise}function xa(b,c){var d=a({method:"get",url:Ja+'?filter={"$and":[{"timestamp":{"$gte":'+b.unix()+',"$lt":'+c.unix()+'}},{"servicename":"pt-statusregistry"}]}&sort=timestamp'});return d.then(V,U)}function ya(a){return _.map(a,function(a){var b=Object.getOwnPropertyNames(a.eventInfo.meta.traffic),c=Object.getOwnPropertyNames(a.eventInfo.meta.validator),d=null,e=a.eventInfo.meta.gps;return d=e?e.active?"OK":"NO_SATELLITE":"FAIL",{timestamp:a.eventInfo.meta.timestamp,vehicleID:a.eventInfo.meta.vehicleId,pp:b,validators:c,gpsStatus:d}})}function za(c,d,e,f){var g=b.defer(),h={startTimestamp:c.unix(),finishTimestamp:d.unix(),sort:"-timestamp"},i=Aa("currencyId",e),j=Aa("source.terminal",f);return i&&j?h.filter='{"$and": ['+j+", "+i+"]}":(i&&(h.filter=i),j&&(h.filter=j)),a({method:"get",url:Ea+"stat/transactions/payments",params:h}).then(function(a){g.resolve(a.data)},function(a){g.reject(a)}),g.promise}function Aa(a,b){var c=null;return b&&b.length>0&&(c=1===b.length?'{ "'+a+'": '+Ba(b[0])+" }":'{ "'+a+'": { "$in": [ '+Ca(b)+" ] } }"),c}function Ba(a){var b=null;switch(typeof a){case"string":b='"'+a+'"';break;case"number":b=a.toString();break;default:b=a.toString()}return b}function Ca(a){var b=null;switch(typeof a[0]){case"string":b=_.map(a,Ba),b=b.join();break;case"number":b=a.toString();break;default:b=a.toString()}return b}function Da(a){return void 0!==a.userId&&null!==a.userId}var Ea="/api/cp/v1/",Fa="/api/pt/v1/",Ga="/api/spd/v1/",Ha="/api/operator/v1/",Ia="/api/auth/v1/login",Ja="/api/protocolmessage/v1/protocolmessage",Ka="/acceptant",La="/uptime",Ma="/dashboard";if(isRestDebug){var Na="https://cp.sarov-itc.ru";Ea=Na+Ea,Fa=Na+Fa,Ga=Na+Ga,Ha=Na+Ha,Ia=Na+Ia,Ja=Na+Ja,Ka=Na+Ka,La=Na+La,Ma=Na+Ma}return a.defaults.headers.common["Content-type"]="application/json",{getAccounts:i,getAccountInfo:j,getAccountBags:k,getAccountTransactions:l,getApps:n,getAppCurrencies:o,getAllTransactions:p,getVehicles:q,getTerminals:r,getVehicleTraffic:t,getPrices:u,getCurrencies:w,getCards:x,getFullyEquippedCards:y,getCard:z,findCardBySrvID:A,findCardByNum:B,findCardByBagID:C,findCardBag:E,findBag:D,getEvents:F,getTurnover:G,getTurnoverHistory:H,getPerson:M,getPassengersInOut:N,postTurnover:X,makePayment:aa,getBaseURL:e,activateEsek:P,activateTicket:Q,getHwCard:R,getHwTicket:S,activateTicketCardReader:T,esekReplenishPoints:Y,esekBuyMonthTicket:Z,esekBuyTicket:$,blockCard:ba,unblockCard:ca,getPassengersInHist:O,getTurnoverHist:I,getStatPaidPrivileges:da,getStatTotalPaidPrivileged:fa,getStatPrivileges:ea,getStatPaidByCardType:ga,getStatTotalPaidByCardType:ha,getStatTotalPassengers:ia,getStatTotalPassKm:qa,getStatTotalServed:ta,getStatPassengersPerDay:ja,getStatPassengersPerDayPerBus:ka,getStatBusesPerDay:ma,getStatPassengersAvgPerHour:pa,getStatPassKmPerDayPerOrg:ra,getStatTransactionsPerDay:na,getStatPassKmPerDay:sa,getStatPassKmPerDayPerBus:la,getStatTransactions:oa,getTariffs:ua,login:wa,getTranspStatusRawData:xa,compactTranspStatusRawData:ya,getAcceptantUrl:f,getUptimeUrl:g,getDashboardUrl:h,getPaymentsBy:za,isEsek:Da}}]),function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j=[].slice;a=function(a){function b(a){this.message=a}return i(b,a),b.prototype.name="ValueError",b}(Error),e="cannot switch from implicit to explicit numbering",c="cannot switch from explicit to implicit numbering",b=function(b){return null==b&&(b={}),function(){var d,g,h,i,k,l;return l=arguments[0],d=2<=arguments.length?j.call(arguments,1):[],h=0,g=i=!1,k="cannot switch from {} to {} numbering",l.replace(/([{}])\1|[{](.*?)(?:!(.+?))?[}]/g,function(j,k,l,m){var n,o,p;if(k)return k;if(l.length){if(i)throw new a(e);g=!0,n=null!=(o=f(d,l))?o:""}else{if(g)throw new a(c);i=!0,n=null!=(p=d[h++])?p:""}return Object.prototype.hasOwnProperty.call(b,m)?b[m](n):n})}},f=function(a,b){var c;for(/^(\d+)([.]|$)/.test(b)||(b="0."+b);c=/(.+?)[.](.+)/.exec(b);)a=g(a,c[1]),b=c[2];return g(a,b)},g=function(a,b){var c;return c=a[b],"function"==typeof c?c.call(a):c},d=b({}),d.create=b,d.extend=function(a,c){var d;d=b(c),a.format=function(){return d.apply(null,[this].concat(j.call(arguments)))}},"undefined"!=typeof module?module.exports=d:"function"==typeof define&&define.amd?define(d):window.format=d}.call(void 0),angular.module("armCtrlPanelApp").run(["$templateCache",function(a){a.put("/ctrl-panel/app/ctrl-panel/ctrlPanel.html",'<snap-drawer id=sidebar><div id=sidebar-title class=pt1>Меню:</div><ul class="nav nav-pills nav-stacked"><li role=presentation ng-repeat="mi in menuItems" ng-class="{ \'active\': isCurrentState(mi.state) }" class=sidebar-menu-item><a ng-click=onMenuItemClick(mi.state) snap-close=snap-close><i ng-class=mi.icon class="fa fa-lg"></i><span class=ml1>{{ mi.title }}</span></a></li></ul></snap-drawer><snap-content snap-opt-disable="\'right\'"><div id=wrapper class="w100 vh100"><span us-spinner="{radius:30, width:8, length: 16}" spinner-on=isGettingData></span><!-- HEADER--><div id=header><div id=header-text><button snap-toggle=left uib-tooltip=Меню tooltip-append-to-body=false tooltip-placement="auto bottom" class="btn btn-default responsive-btn mr1"><i class="fa fa-bars"></i></button><span>Контрольная панель оператора</span></div><!-- Navi menu--><div id=navi-menu><div uib-dropdown="" class=btn-group><button id=navi-menu-button type=button uib-dropdown-toggle="" class="btn btn-primary responsive-btn"><span>Перейти к&nbsp;&nbsp;</span><span class=caret></span></button><ul uib-dropdown-menu="" role=menu aria-labelledby=navi-menu-button><li role=menuitem ng-repeat="menuItem in naviMenuItems"><a ng-href={{menuItem.url}}>{{menuItem.name}}</a></li></ul></div></div><div id=user-section ng-show="Auth.getCurrentUser() !== undefined"><span style="margin-right: 10px">Оператор: {{ Auth.getCurrentUser() }}</span><button ng-click=onSettingsBtnClick() disabled style="margin-right: 5px" class="btn btn-default responsive-btn"><i class="fa fa-cog"></i></button><button ng-click=onLogOutBtnClick() style="margin-right: 5px" uib-tooltip=Выйти tooltip-append-to-body=true tooltip-placement="auto bottom" class="btn btn-default responsive-btn"><i class="fa fa-sign-out"></i></button></div></div><!-- CONTENT--><div id=content class=ui-view></div><!-- FOOTER--><footer id=footer class=text-center>Copyright &copy; 2015-2016 &mdash;&nbsp;<a href="http://sarov-itc.ru/" target=_blank>ИТЦ Система-Саров</a><span>,&nbsp;&nbsp;</span><a href="https://www.me-so.ru/" target=_blank>ДЦ "Микрон"</a></footer><div id=alert-section ng-show="alerts.length &gt; 0" class=msg-in-center><uib-alert ng-repeat="alert in alerts" type={{alert.type}} close=alert.close() class=alert-fading-out><span ng-bind=alert.msg></span></uib-alert></div></div></snap-content>'),a.put("/ctrl-panel/app/ctrl-panel/hardware.html","<div id=hw-page-content><p>Hello this was the uptime page.</p></div>"),a.put("/ctrl-panel/app/ctrl-panel/statistic.html",'<div id=stat-title class=p1><span class=text-large>Статистика за&nbsp;</span><strong id=stat-time-period class="text-large mr1">{{ datePicker.date | DatePickerFilter}}</strong><!-- Time period selector--><button date-range-picker=date-range-picker ng-model=datePicker.date options=dateRangePickerOpts max=today ng-disabled=isGettingData uib-tooltip="Выбрать дату или период" tooltip-append-to-body=true tooltip-placement="auto bottom" class="btn btn-default responsive-btn"><i class="glyphicon glyphicon-calendar"></i></button></div><div id=stat-grouping class="plr1 pb1"><div id=stat-grouping-wrapper class="p1 b1 rounded"><div class=text-large>Группировка данных</div><!-- Gropping type selector--><label class=radio-inline>По дате<input type=radio name=groupingRadio value=day ng-model="groupBy"></label><label class=radio-inline>По номеру борта<input type=radio name=groupingRadio value=bus ng-model="groupBy"></label></div></div><div id=stat-buttons class="plr1 pb2"><!-- Load button--><button ng-click=onLoadBtnClick() ng-disabled="!isFilterChanged || isGettingData" class="btn btn-primary"><i ng-class="{ \'fa-pulse\' : isGettingData }" class="fa fa-spinner"></i><span>&nbsp;Загрузить</span></button><!-- Export button--><button ng-click=onExportBtnClick() ng-disabled="gridOptions.data.length === 0" class="btn btn-default ml2 mr1"><i class="fa fa-floppy-o"></i><span>&nbsp;Экспорт в файл</span></button><!-- Export format selector--><!--label.radio-inline CSV--><!--  input(type=\'radio\', name=\'exportFrmtRadio\', value=\'csv\', ng-model="exportFormat")--><!--label.radio-inline PDF--><!--  input(type=\'radio\', name=\'exportFrmtRadio\', value=\'pdf\', ng-model="exportFormat", disabled)--></div><div id=stat-table-wrapper ng-hide="gridOptions.data.length === 0 || isFilterChanged" class="plr1 pb1"><div id=stat-table ui-grid=gridOptions ui-grid-auto-resize=ui-grid-auto-resize ui-grid-move-columns=ui-grid-move-columns ui-grid-exporter=ui-grid-exporter ui-grid-grouping=ui-grid-grouping ui-grid-save-state=ui-grid-save-state class=grid></div></div><div id=stat-nodata-msg-wrapper ng-show="noData &amp;&amp; !isFilterChanged"><div id=stat-nodata-msg>Данных по запросу не найдено</div></div><!--#stat-wrapper--><!--  #stat-page-in-dev-msg Страница находится в разработке-->'),a.put("/ctrl-panel/app/ctrl-panel/transactions.html",'<div id=trans-title class=p1><span class=text-large>Учтенные транзакции за&nbsp;</span><strong id=trans-time-period class="text-large mr1">{{ datePicker.date | DatePickerFilter}}</strong><!-- Time period selector--><button date-range-picker=date-range-picker ng-model=datePicker.date options=dateRangePickerOpts max=today ng-disabled=isGettingData uib-tooltip="Выбрать дату или период" tooltip-append-to-body=true tooltip-placement="auto bottom" class="btn btn-default responsive-btn"><i class="glyphicon glyphicon-calendar"></i></button></div><div id=trans-filters class="plr1 pb1"><div id=trans-filter-wrapper class="p1 b1 rounded"><div class=text-large>Фильтры данных</div><div class="Grid Grid--center"><div class="Grid-cell--autoSize ptb1 pr1"><label>Борты:&nbsp;</label><strong ng-show="selectedBuses.length === busOptions.length &amp;&amp; busOptions.length &gt; 0" class=all-selected-marker>Все</strong><strong ng-show="selectedBuses.length === 0 &amp;&amp; busOptions.length &gt; 0" class=none-selected-marker>Не выбраны</strong><div ng-dropdown-multiselect="" options=busOptions selected-model=selectedBuses extra-settings=busDdSettings checkboxes=true translation-texts=ruTranslation class="dd-ms min-w25"></div></div><div class="Grid-cell--autoSize p1"><label>Способы оплаты:&nbsp;</label><strong ng-show="selectedPaymentMethods.length === paymentMethOptions.length &amp;&amp; paymentMethOptions.length &gt; 0" class=all-selected-marker>Все</strong><strong ng-show="selectedPaymentMethods.length === 0 &amp;&amp; paymentMethOptions.length &gt; 0" class=none-selected-marker>Не выбраны</strong><div ng-dropdown-multiselect="" options=paymentMethOptions selected-model=selectedPaymentMethods extra-settings=paymentMethSettings checkboxes=true translation-texts=ruTranslation class="dd-ms min-w25"></div></div><div class="Grid-cell--autoSize p1"><label>Типы карт:&nbsp;</label><strong ng-show="selectedCardTypes.length === cardTypeOptions.length &amp;&amp; cardTypeOptions.length &gt; 0" class=all-selected-marker>Все</strong><strong ng-show="selectedCardTypes.length === 0 &amp;&amp; cardTypeOptions.length &gt; 0" class=none-selected-marker>Не выбраны</strong><div ng-dropdown-multiselect="" options=cardTypeOptions selected-model=selectedCardTypes extra-settings=cardTypeSettings checkboxes=true translation-texts=ruTranslation class="dd-ms min-w25"></div></div><!--.Grid-cell--autoSize.p1--><!--  label Номера карт:&nbsp;--><!--  strong.all-selected-marker(ng-show="selectedCards.length === cardOptions.length && " +--><!--  "cardOptions.length > 0") Все--><!--  strong.none-selected-marker(ng-show="selectedCards.length === 0 && cardOptions.length > 0") Не выбраны--><!--  .dd-ms.min-w25(ng-dropdown-multiselect="", options="cardOptions", selected-model="selectedCards",--><!--  extra-settings="cardSettings", checkboxes="true", translation-texts="ruTranslation")--></div></div></div><div id=trans-buttons class="plr1 pb2"><!-- Load button--><button ng-click=onLoadBtnClick() ng-disabled="!isFilterChanged || isGettingData || selectedPaymentMethods.length === 0 || selectedCardTypes.length === 0" class="btn btn-primary"><i ng-class="{ \'fa-pulse\' : isGettingData }" class="fa fa-spinner"></i><span>&nbsp;Загрузить</span></button><!-- Export button--><button ng-click=onExportBtnClick() ng-disabled="gridOptions.data.length === 0" class="btn btn-default ml2 mr1"><i class="fa fa-floppy-o"></i><span>&nbsp;Экспорт в файл</span></button><!-- Export format selector--><!--label.radio-inline CSV--><!--  input(type=\'radio\', name=\'exportFrmtRadio\', value=\'csv\', ng-model="exportFormat")--><!--label.radio-inline PDF--><!--  input(type=\'radio\', name=\'exportFrmtRadio\', value=\'pdf\', ng-model="exportFormat", disabled)--></div><div id=trans-table-wrapper ng-hide="gridOptions.data.length === 0 || isFilterChanged" class="plr1 pb1"><div id=trans-table ui-grid=gridOptions ui-grid-auto-resize=ui-grid-auto-resize ui-grid-pagination=ui-grid-pagination ui-grid-move-columns=ui-grid-move-columns ui-grid-exporter=ui-grid-exporter ui-grid-save-state=ui-grid-save-state class=grid></div></div><div id=trans-nodata-msg-wrapper ng-show="noData &amp;&amp; !isFilterChanged"><div id=trans-nodata-msg>Данных по запросу не найдено</div></div>'),a.put("/ctrl-panel/app/test/test.html",'<h4>Inline</h4><pre>Selected date is: {{dt | date:\'fullDate\' }}</pre><div style="display:inline-block; min-height:290px"><uib-datepicker ng-model=dt min-date=minDate show-weeks=true custom-class="getDayClass(date, mode)" class="well well-sm"></uib-datepicker></div><h4>Popup</h4><div class=row><div class=col-md-6><p class=input-group><input uib-datepicker-popup={{format}} ng-model=dt is-open=status.opened min-date=minDate max-date=maxDate datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true class="form-control"><span class=input-group-btn><button type=button ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><div class=col-md-6><p class=input-group><input type=date uib-datepicker-popup="" ng-model=dt is-open=status.opened min-date=minDate max-date=maxDate datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true close-text=Close class="form-control"><span class=input-group-btn><button type=button ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></div><div class=row><div class=col-md-6><label>Format:</label><select ng-model=format ng-options="f for f in formats" class=form-control><option></option></select></div></div><hr><button type=button ng-click=today() class="btn btn-sm btn-info">Today</button><button type=button ng-click="setDate(2009, 7, 24)" class="btn btn-sm btn-default">2009-08-24</button><button type=button ng-click=clear() class="btn btn-sm btn-danger">Clear</button><button type=button ng-click=toggleMin() uib-tooltip="After today restriction" class="btn btn-sm btn-default">Min date</button>'),a.put("/ctrl-panel/components/shared/login/login.html",'<div id=login-wrapper class="w100 vh100"><div id=login-title class="w100 text-center">{{ title }}</div><div class=Grid><div id=login-left-margin class=Grid-cell></div><div id=login-center-part style="padding-top: 10px" class=Grid-cell><form name=form ng-submit=login(form) novalidate class=form><div class=form-group><label>Имя пользователя</label><input id=username-input name=username ng-model=username class="form-control"></div><div class=form-group><label>Пароль</label><input type=password name=password ng-model=password class="form-control"></div><div class="form-group has-error"><p ng-show="form.username.$error.required &amp;&amp; form.password.$error.required &amp;&amp; submitted" class=help-block>Пожалуйста, введите имя пользователя и пароль</p><p class=help-block>{{ errors.other }}</p></div><div><button type=submit class="btn btn-primary">Войти</button></div></form></div><div id=login-right-margin class=Grid-cell></div></div></div>'),a.put("/ctrl-panel/components/shared/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>')}]);